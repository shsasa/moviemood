<body>
  <h1>
    <%= movie.title %>
  </h1>
  <%- include('../partials/_navbar.ejs') %>

    <div style="text-align: center; margin-top: 20px">
      <% if (movie.poster_path) { %>
        <img src="https://image.tmdb.org/t/p/w300<%= movie.poster_path %>" alt="<%= movie.title %>"
          style="width: 300px" />
        <% } else { %>
          <p>No poster available</p>
          <% } %>
    </div>

    <div style="margin-top: 20px; text-align: center">
      <p><strong>Overview:</strong>
        <%= movie.overview %>
      </p>
      <p><strong>Release Date:</strong>
        <%= movie.release_date %>
      </p>
      <p>
        <strong>Rating:</strong>
        <%= movie.vote_average %> (Votes: <%= movie.vote_count %>)
      </p>
      <p><strong>Popularity:</strong>
        <%= movie.popularity %>
      </p>
      <p><strong>Language:</strong>
        <%= movie.original_language %>
      </p>
    </div>

    <% if (trailerKey) { %>
      <div style="margin-top: 20px; text-align: center">
        <h2>Watch Trailer</h2>
        <iframe width="560" height="315" src="https://www.youtube.com/embed/<%= trailerKey %>"
          title="YouTube video player" frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen></iframe>
      </div>
      <% } else { %>
        <p style="text-align: center; margin-top: 20px;">No trailer available</p>
        <% } %>



          <% if (user) { %>

            <div style="margin-top: 20px; text-align: center">
              <% if (isFavorite) { %>
                <!-- Remove from Favorites -->
                <form action="/favorites/<%= movie.id %>/?_method=DELETE" method="post">
                  <button type="submit" style="
          padding: 10px 20px;
          background-color: red;
          color: white;
          border: none;
          cursor: pointer;
        ">
                    Remove from Favorites
                  </button>
                </form>
                <% } else { %>
                  <!-- Add to Favorites -->
                  <form action="/favorites/" method="post">
                    <input type="hidden" name="title" value="<%= movie.title %>" />
                    <input type="hidden" name="apiId" value="<%= movie.id %>" />
                    <input type="hidden" name="poster_path" value="<%= movie.poster_path %>" />
                    <button type="submit" style="
          padding: 10px 20px;
          background-color: green;
          color: white;
          border: none;
          cursor: pointer;
        ">
                      Add to Favorites
                    </button>
                  </form>
                  <% } %>
            </div>
         <% } %>   
 <!-- show existing reviews -->
  <div class="review-section">
    <h2>Reviews</h2>
    <% if(reviews && reviews.length >0){ %>
      <%reviews.forEach(review =>{ %>
<div class="review-box">
  <p><strong><%= review.user.username %>:</strong></p>
  <p><%= review.rating %>/5</p>
  <p><%= review.comment %></p>
</div>
    <%  }) %>
    <% } else { %>
    
    <p>No reviews yet. Be the first to write one!</p>

    <% } %>
    <!-- Add or Update review -->
     <% if (user){ %>
      <div class="review-form">
        <h3><%= userReview ? "Update Your Review" :"Leave a Review"%></h3>
        <form action="<%= userReview ? `/reviews/${userReview._id}?_method=PUT` : '/reviews' %>" method="POST">
          <input type="hidden" name="movieId" value="<%=movie.id %>">
<label for ="rating">Rating:</label>
<select name ="rating" id="rating" required>
  <option value="" disabled selected>Choose a rating</option>
  <% for (let i =1;i <=5; i++){ %>
  <option value="<%= i %>"><%= i %></option>
    <%} %>
</select>
<br /> <br />
<label for="comment">Comment:</label><br/>
<textarea name="comment" id="comment" rows="4" cols="100" required><%= userReview ? userReview.comment : "" %></textarea>
<br /> <br />
<button type="submit"><%= userReview ? "Update Review" : "Submit Review" %></button>
        </form>
      </div>

   <%  } %>
  </div>
</body>